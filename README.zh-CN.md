## PieStream

**PieStream** 实现了一种在流数据复杂事件处理（CEP）中高效检测区间时序模式的方法。

传统CEP系统因顺序模式匹配效率低下，难以处理复杂查询。我们的方法将具有区间关系的二元事件对转化为正则表达式和自动机，实现低延迟模式识别。通过将复杂模式分解为独立事件对并使用自然连接，获得了更精确高效的检测结果。

实验评估表明，该方法显著优于现有技术，具有近拟线性时间和空间复杂度。

### 挑战

1. **时序关系处理的局限性**：顺序模式匹配方法难以处理跨越时间的区间事件及其复杂时序关系，尤其在事件重叠或相关时。表达多个Allen区间关系会增加处理复杂度。

2. **现有方法的可扩展性问题**：TPStream等先进方法虽能低延迟检测区间事件对，但在处理复杂模式时面临指数级复杂度。随着问题规模增大，性能显著下降，使其不适用于大规模实时流数据场景。

### 解决方案

为应对实时流数据中复杂时序模式的检测挑战，我们提出包含两个关键步骤的新方法：

1. **二元事件对的分解与检测**
   首先将复杂时序模式分解为简单二元事件对，通过正则表达式和自动机表示，实现高效的区间模式低延迟识别。每个二元事件对可独立检测，在常数时间内获取结果。

2. **通过自然连接高效组装**
   检测到二元事件对后，使用自然连接无缝组装完整时序模式。整个过程具有近拟线性时间复杂度。

### 核心贡献

- 提出创新框架：将基于谓词的区间事件对转化为正则表达式和自动机，高效编码时序关系，实现流数据中复杂区间模式的低延迟检测。

- 开发可扩展方案：不仅将时间复杂度从指数级降至近拟线性，同时实现近拟线性空间复杂度，显著提升实时流系统处理复杂查询的效率。

### 实验

#### 处理时间
实验比较了**[PieStream](https://github.com/cyann7/PieStream)**与**[TPStream](http://uni-marburg.de/oaCPk)**在相同合成数据集上的处理时间。通过调整PIE数量改变查询复杂度（n个PIE序列形成n-1个mPiePair，每个包含6种Allen时序关系）。

实验采用10,000窗口大小和最快事件输入速率，测试不同事件量级（10³至10⁷）。通过4-24个PIE的多轮测试评估处理时间和系统可扩展性。

<div style="display: flex; justify-content: space-around;">
<img src="attachments/pies_time.png" alt="pies_time" style="width: 48%;"/>
<img src="attachments/events_time.png" alt="events_time" style="width: 48%;"/>
</div>

左图显示PieStream处理时间随问题规模拟线性增长，而TPStream呈指数增长。当PIE超过16个时，TPStream因直接匹配方法失效。PieStream虽因索引构建开销在小规模时较慢，但通过索引和结果管理减少冗余计算，随规模增大反超TPStream。

右图表明当PIE超过12个后，PieStream始终保持更低处理时间。TPStream在小规模时表现更优，但性能差距随规模扩大而加剧。

注：PieStream实验代码均位于`scripts`文件夹。

### 结论
我们提出了一种新型高效复杂事件处理框架：将含区间关系的二元事件对转化为正则表达式和自动机，实现低延迟识别。通过分解复杂模式为独立事件对并使用自然连接，实现了更精准高效的检测。实验证明该方法在处理复杂查询时优于前沿技术。

## 代码运行指南

1. 克隆仓库：
```bash
git clone git@github.com:cyann7/PieStream.git
cd PieStream
```

2. 编译源代码：
```bash
mvn clean install
```

3. 修改`scripts/env`并运行`scripts`文件夹中的实验脚本：
```bash
cd scripts
# 首先修改 scripts/env
./processedTime.sh
```

4. 在`scripts/out`目录查看结果

## 致谢
本研究由国家自然科学基金委员会（NSFC）与德国科学基金会（DFG）合作交流项目资助（项目编号：62061136006）。
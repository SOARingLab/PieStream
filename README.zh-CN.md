## PieStream

**PieStream** 实现了一种在流数据复杂事件处理（CEP）中高效检测区间时序模式的方法。

传统CEP系统因顺序模式匹配效率低下，难以处理复杂查询。我们的方法将具有区间关系的二元事件对转化为正则表达式和自动机，实现低延迟模式识别。通过将复杂模式分解为独立事件对并使用自然连接，获得了更精确高效的检测结果。

实验评估表明，该方法显著优于现有技术，具有近拟线性时间和空间复杂度。


### 挑战

1. **事件延迟问题**
   传统方法需等待完整事件区间才能检测，导致高延迟，无法满足实时流处理需求。TPStream等方法在极限数据输入速率下平均处理延迟较高。

2. **复杂查询效率低下**
   复杂查询（如区间事件对组合）导致指数级时间复杂度。现有方法（如TPStream）在问题规模增大时性能急剧下降，无法处理大规模流数据。

3. **时态关系语义不精确**
   传统Allen关系（如before/after）产生高误报率，浪费系统资源且降低检测准确性。


### 解决方法

1. **原子化低延迟检测**
   将单时态关系的区间事件对编码为符号正则表达式和自动机，实现事件级即时检测，消除等待延迟。 

2. **分治合并优化**
   采用两阶段分解：
- 将复杂模式拆解为原子事件对独立检测
- 通过增量式自然连接合并结果（窗口内物化中间结果减少重复计算）
  时间复杂度从指数级优化至准线性。

3. **精确时态关系建模**
   提出新关系操作符：
- `followed-by`（紧邻后继）
- `follows`（紧邻前驱）
  替代传统before/after，在LNG案例中误报率从79%降至0%。

### 核心贡献

1. **低延迟检测框架**
   首创基于自动机的原子事件对即时检测机制，实现流事件级处理，极限速率下延迟降低超30%。

2. **准线性复杂度算法**
   通过分治策略和增量连接优化，突破复杂查询的性能瓶颈：
- 时间复杂度：指数级 → 准线性
- 空间复杂度：准线性

3. **零误报时态模型**
   定义精确时序语义操作符： 完全消除传统before/after的语义歧义


### 实验

#### 平均处理时间
实验比较了**PieStream**与**[TPStream](http://uni-marburg.de/oaCPk)**在相同合成数据集上的处理时间。通过调整PIE数量改变查询复杂度（n个PIE序列形成n-1个mPiePair，每个包含6种Allen时序关系）。

实验采用10,000窗口大小和最快事件输入速率，测试不同事件量级（10³至10⁷）。通过4-24个PIE的多轮测试评估处理时间和系统可扩展性。

<div style="display: flex; justify-content: space-around;">
<img src="attachments/pies_time.png" alt="pies_time" style="width: 48%;"/>
<img src="attachments/events_time.png" alt="events_time" style="width: 48%;"/>
</div>

左图显示PieStream处理时间随问题规模拟线性增长，而TPStream呈指数增长。当PIE超过16个时，TPStream因直接匹配方法失效。PieStream虽因索引构建开销在小规模时较慢，但通过索引和结果管理减少冗余计算，随规模增大反超TPStream。

右图表明当PIE超过12个后，PieStream始终保持更低处理时间。TPStream在小规模时表现更优，但性能差距随规模扩大而加剧。

注：PieStream实验代码均位于`scripts`文件夹。

### 结论
我们提出了一种新型高效复杂事件处理框架：将含区间关系的二元事件对转化为正则表达式和自动机，实现低延迟识别。通过分解复杂模式为独立事件对并使用自然连接，实现了更精准高效的检测。实验证明该方法在处理复杂查询时优于前沿技术。

## 代码运行指南

1. 克隆仓库：
```bash 
cd PieStream
```

2. 编译源代码：
```bash
mvn clean install
```

3. 修改`scripts/env`并运行`scripts`文件夹中的实验脚本：
```bash
cd scripts
# 首先修改 scripts/env
./processedTime.sh
```

4. 在`scripts/out`目录查看结果

## 致谢
本研究由国家自然科学基金委员会合作交流项目资助NSFC-DFG (Grant No. 62061136006)。